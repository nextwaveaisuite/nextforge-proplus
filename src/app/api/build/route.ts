import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  try {
    const { structure, app_type } = await req.json();

    if (!structure || !app_type) {
      return NextResponse.json(
        { error: "Missing structure or app_type" },
        { status: 400 }
      );
    }

    const generatedFiles = {};

    for (const filePath in structure) {
      generatedFiles[filePath] = getCodeTemplate(app_type, filePath);
    }

    return NextResponse.json({
      success: true,
      files: generatedFiles
    });

  } catch (err) {
    return NextResponse.json(
      { error: "Server error during code generation" },
      { status: 500 }
    );
  }
}

function getCodeTemplate(app_type, filePath) {
  if (filePath.endsWith("page.tsx")) {
    return `
export default function Page() {
  return (
    <div className="p-6">
      <h1 className="text-xl font-bold">Generated ${app_type} Page</h1>
      <p>This file was generated by NextForge AI Pro+.</p>
    </div>
  );
}
`;
  }

  if (filePath.includes("api")) {
    return `
import { NextRequest, NextResponse } from "next/server";

export async function POST(req: NextRequest) {
  return NextResponse.json({ message: "Generated API route for ${app_type}" });
}
`;
  }

  if (filePath.includes("Header")) {
    return `
export default function Header() {
  return (
    <header className="p-4 bg-gray-900 text-white">
      <h1>${app_type} App</h1>
    </header>
  );
}
`;
  }

  if (filePath.includes("Footer")) {
    return `
export default function Footer() {
  return (
    <footer className="p-4 text-center text-gray-400">
      <p>Generated by NextForge AI Pro+</p>
    </footer>
  );
}
`;
  }

  return "// Generated by NextForge AI Pro+";
}